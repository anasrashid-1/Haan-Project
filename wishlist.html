<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="product.css">
</head>
<body >
   
    <div id="ans-wish-page-conatiner">
        <hr>
        <div id="ans-main-product-container">
        
        </div>
        <hr>
    </div>
    
</body>
<script>
    let wishListProducts = JSON.parse(localStorage.getItem("cart-wish-db"))
    console.log(wishListProducts)
    document.getElementById("ans-main-product-container").innerHTML = `
            <div id="loading-img-cont">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif?20151024034921" alt="">
            </div>`;

        setTimeout(() => {
            displayData(wishListProducts);
        }, 1000);


    let lsArr = JSON.parse(localStorage.getItem("card-product-db")) || [];
    const displayData = (data) => {
    let pMainContainer = document.getElementById("ans-main-product-container");
    pMainContainer.innerHTML = null;

    let productsList = document.createElement("div");
    productsList.setAttribute("class", "ans-product-list");

    data.forEach((element, index) => {
        let productCard = document.createElement("div");
        productCard.setAttribute("class", "ans-product-card");
        let productImg = document.createElement("div");
        productImg.setAttribute("class", "prodct-img-cont");
        let img = document.createElement("img");

        let productBody = document.createElement("div");
        productBody.setAttribute("class", "prodct-body");
        let h3 = document.createElement("h3");
        h3.setAttribute("class", "product-name");
        let dp = document.createElement("p");
        let op = document.createElement("p");

        let wish_cart_cont = document.createElement("div")
        wish_cart_cont.setAttribute("class", "wish_cart_cont")
        // wish_cart_cont.innerHTML = `<ion-icon id="ion-icon" name="heart-outline"></ion-icon>`
        let ion_icon = document.createElement("ion-icon")
        ion_icon.setAttribute("name", "trash-outline")
        ion_icon.setAttribute("id", "ion-icon")
        let cardBtn = document.createElement("button");
        cardBtn.setAttribute("class", "ans-btn");
        
        cardBtn.textContent = "Add to Cart";

        img.src = element.img;
        h3.textContent = element.name;
        dp.textContent = "₹" + element.discounted_price;
        op.textContent = "₹" + element.price;
        op.setAttribute("id", "p-or-price");
        productImg.append(img);
        wish_cart_cont.append( ion_icon ,cardBtn)
        productBody.append(h3, dp, op, wish_cart_cont);
        productCard.append(productImg, productBody);
        productsList.append(productCard);

        h3.style.cursor = "pointer";
        h3.addEventListener("click", function () {
            localStorage.setItem("product-det", JSON.stringify(element));
            window.location.href = "product-description.html";

            let filteredSimilarProducts = fetchedData.filter((el) => {
                return el.category === element.category && el.pack === element.pack;
            });
            localStorage.setItem(
                "similar-products-db",
                JSON.stringify(filteredSimilarProducts)
            );
        });

        img.style.cursor = "pointer";
        img.addEventListener("click", function () {
            localStorage.setItem("product-det", JSON.stringify(element));
            window.location.href = "product-description.html";

            let filteredSimilarProducts = fetchedData.filter((el) => {
                return el.category === element.category && el.pack === element.pack;
            });
            localStorage.setItem(
                "similar-products-db",
                JSON.stringify(filteredSimilarProducts)
            );

        });

        ion_icon.addEventListener("click", function(){
            event.target.parentNode.parentNode.parentNode.remove();
            console.log(wishListProducts)
            wishListProducts.splice(1,1)
            localStorage.setItem("cart-wish-db", JSON.stringify(wishListProducts));
            console.log(wishListProducts)
        })

 
        cardBtn.addEventListener("click", function () {
            let isProductAlreadyPresent = false;
            if (lsArr.length > 0) {
                lsArr.forEach((item) => {
                    if (item.id === element.id) {
                        isProductAlreadyPresent = true;
                        return; 
                    }
                });
            }
            if (isProductAlreadyPresent) {
                alert("Product is already present in the cart.");
            } else {
                lsArr.push(element);
                localStorage.setItem("card-product-db", JSON.stringify(lsArr));
                alert("Product added to cart successfully.");
            }
        });
        cardBtn.style.cursor = "pointer";
    });
    pMainContainer.append(productsList);
};



</script>
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
</html>